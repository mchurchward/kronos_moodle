YUI.add("moodle-block_rlagent-mass",function(e,t){M.block_rlagent=M.block_rlagent||{},M.block_rlagent={data_actions:{add:{},remove:{},update:{}},data_addons:{},data_filters:{},filter_types:["type","status","string"],plugin_modal:null,plugin_rate_node:null,plugin_types:{block:{type:"block",title:M.util.get_string("title_block","block_rlagent"),icon:"fa-square-o"},mod:{type:"mod",title:M.util.get_string("title_module","block_rlagent"),icon:"fa-rocket"},auth:{type:"auth",title:M.util.get_string("title_auth","block_rlagent"),icon:"fa-key"},enrol:{type:"enrol",title:M.util.get_string("title_enrol","block_rlagent"),icon:"fa-group"},filter:{type:"filter",title:M.util.get_string("title_filter","block_rlagent"),icon:"fa-filter"},format:{type:"format",title:M.util.get_string("title_format","block_rlagent"),icon:"fa-columns"},gradeexport:{type:"gradeexport",title:M.util.get_string("title_gradeexport","block_rlagent"),icon:"fa-download"},local:{type:"local",title:M.util.get_string("title_local","block_rlagent"),icon:"fa-home"},qtype:{type:"qtype",title:M.util.get_string("title_qtype","block_rlagent"),icon:"fa-check-square-o"},repository:{type:"repository",title:M.util.get_string("title_repository","block_rlagent"),icon:"fa-folder-open"},theme:{type:"theme",title:M.util.get_string("title_theme","block_rlagent"),icon:"fa-picture-o"},tinymce:{type:"tinymce",title:M.util.get_string("title_tinymce","block_rlagent"),icon:"fa-text-height"},plagiarism:{type:"plagiarism",title:M.util.get_string("title_plagiarism","block_rlagent"),icon:"fa-eye"}},action_dropdown_update:function(){function t(t){t.preventDefault,$this=t.target,$key=$this.ancestor("li").getAttribute("data-key"),$action=$this.ancestor("li").getAttribute("data-action"),delete M.block_rlagent.data_actions[$action][$key],Object.keys(M.block_rlagent.data_actions.add).length===0&&Object.keys(M.block_rlagent.data_actions.remove).length===0&&Object.keys(M.block_rlagent.data_actions.update).length===0&&(e.one("ul#plugin-actions").setStyle("display","none"),$dropbtn.hasClass("disabled")||$dropbtn.addClass("disabled"),$updatebtn.hasClass("disabled")||$updatebtn.addClass("disabled")),$this.ancestor("li").remove(!0),$btn=e.one('.plugin.well[data-key="'+$key+'"] button[data-action="'+$action+'"]'),$btn.hasClass("disabled")&&$btn.removeClass("disabled")}$ul=e.one("ul#plugin-actions"),$dropbtn=e.one("button.plugin-actions"),$updatebtn=e.one("#go-update-plugins"),$ul.detach("click");if(Object.keys(M.block_rlagent.data_actions.add).length===0&&Object.keys(M.block_rlagent.data_actions.remove).length===0&&Object.keys(M.block_rlagent.data_actions.update).length===0)return $items=$ul.all("li"),$items.size()&&$ul.empty(),$dropbtn.hasClass("disabled")||$dropbtn.addClass("disabled"),$updatebtn.hasClass("disabled")||$updatebtn.addClass("disabled"),!1;Object.keys(M.block_rlagent.data_actions.add).length>0&&($ul.all('[data-action="add"]').remove(!0),e.Object.each(M.block_rlagent.data_actions.add,function(e,t){var n;n='<li data-action="add" ',n+='data-key="'+t+'">',n+='<i class="fa fa-plus" alt="'+M.util.get_string("to_be_added","block_rlagent")+'"></i>',n+=M.block_rlagent.data_addons[t].display_name,n+='<i class="fa fa-times-circle rm-action" alt="'+M.util.get_string("remove_action","block_rlagent")+'"></i>',n+="</li>",$ul.append(n)}),$dropbtn.hasClass("disabled")&&$dropbtn.removeClass("disabled"),$updatebtn.hasClass("disabled")&&$updatebtn.removeClass("disabled")),Object.keys(M.block_rlagent.data_actions.remove).length>0&&($ul.all('[data-action="remove"]').remove(!0),e.Object.each(M.block_rlagent.data_actions.remove,function(e,t){var n;n='<li data-action="remove" ',n+='data-key="'+t+'">',n+='<i class="fa fa-times" alt="'+M.util.get_string("to_be_added","block_rlagent")+'"></i>',n+=M.block_rlagent.data_addons[t].display_name,n+='<i class="fa fa-times-circle rm-action" alt="'+M.util.get_string("remove_action","block_rlagent")+'"></i>',n+="</li>",$ul.append(n)}),$dropbtn.hasClass("disabled")&&$dropbtn.removeClass("disabled"),$updatebtn.hasClass("disabled")&&$updatebtn.removeClass("disabled")),Object.keys(M.block_rlagent.data_actions.update).length>0&&($ul.all('[data-action="update"]').remove(!0),e.Object.each(M.block_rlagent.data_actions.update,function(e,t){var n;n='<li data-action="update" ',n+='data-key="'+t+'">',n+='<i class="fa fa-level-up" alt="'+M.util.get_string("to_be_updated","block_rlagent")+'"></i>',n+=M.block_rlagent.data_addons[t].display_name,n+='<i class="fa fa-times-circle rm-action" alt="'+M.util.get_string("remove_action","block_rlagent")+'"></i>',n+="</li>",$ul.append(n)}),$dropbtn.hasClass("disabled")&&$dropbtn.removeClass("disabled"),$updatebtn.hasClass("disabled")&&$updatebtn.removeClass("disabled")),$ul.delegate("click",t,".rm-action")},addons_button_init:function(){function t(e){e.preventDefault(),$this=e.target;if($this.hasClass("disabled"))return;var t=$this.ancestor(".plugin.well").getAttribute("data-key");M.block_rlagent.data_actions.add[t]=t,$this.addClass("disabled"),M.block_rlagent.action_dropdown_update()}function n(e){e.preventDefault(),$this=e.target;if($this.hasClass("disabled"))return;var t=$this.ancestor(".plugin.well").getAttribute("data-key");M.block_rlagent.data_actions.remove[t]=t,$this.addClass("disabled"),M.block_rlagent.action_dropdown_update()}function r(e){e.preventDefault(),$this=e.target;if($this.hasClass("disabled"))return;var t=$this.ancestor(".plugin.well").getAttribute("data-key");M.block_rlagent.data_actions.update[t]=t,$this.addClass("disabled"),M.block_rlagent.action_dropdown_update()}function i(t){t.preventDefault();var n="<ul>"+M.util.get_string("plugins_will_be_added","block_rlagent"),r;for(r in M.block_rlagent.data_actions.add)n+="<li>"+r+"</li>";n+="</ul>",n+="<ul>"+M.util.get_string("plugins_will_be_updated","block_rlagent");for(r in M.block_rlagent.data_actions.update)n+="<li>"+r+"</li>";n+="</ul>",n+="<ul>"+M.util.get_string("plugins_will_be_removed","block_rlagent");for(r in M.block_rlagent.data_actions.remove)n+="<li>"+
r+"</li>";n+="</ul>",$bodycontent='<div id="modal-content">',$bodycontent+="<h4>"+M.util.get_string("preparing_actions","block_rlagent")+"</h4>",$bodycontent+="<p>"+n+"</p>",$bodycontent+='<div id="action-results"><i class="fa fa-spinner fa-spin fa-4"></i></div>',$bodycontent+="</div>",YUI().use("panel",function(e){M.block_rlagent.plugin_modal=new e.Panel({srcNode:"<div></div>",id:"manage-actions-modal",headerContent:M.util.get_string("actions_in_progress","block_rlagent"),bodyContent:$bodycontent,buttons:[{id:"modal-confirm-button",label:M.util.get_string("confirm","block_rlagent"),section:"footer",action:function(t){t.preventDefault(),t.target.hide(),e.one("#manage-actions-modal .modal-cancel-button").set("label",M.util.get_string("close","block_rlagent")),s(t)},classNames:"modal-confirm-button",disabled:!0},{id:"modal-cancel-button",label:M.util.get_string("cancel","block_rlagent"),section:"footer",action:function(e){e.preventDefault(),M.block_rlagent.plugin_modal.hide(),M.block_rlagent.plugin_modal.destroy()},classNames:"modal-cancel-button",disabled:!0}],classNames:"manage-actions-modal",width:"60%",height:500,zIndex:1e4,centered:!0,modal:!0,visible:!0,render:!0})});var i="",o={};e.Object.each(M.block_rlagent.data_actions.add,function(t,n){typeof M.block_rlagent.data_addons[n].cache=="object"&&"dependencies"in M.block_rlagent.data_addons[n].cache&&e.Object.each(M.block_rlagent.data_addons[n].cache.dependencies,function(e,t){M.block_rlagent.data_addons[t].installed||(M.block_rlagent.data_actions.add[t]=t,o={source:n,target:t},i+="<ul>"+M.util.get_string("dependency_will_be_added","block_rlagent",o))})}),e.Object.each(M.block_rlagent.data_actions.update,function(t,n){typeof M.block_rlagent.data_addons[n].cache=="object"&&"dependencies"in M.block_rlagent.data_addons[n].cache&&e.Object.each(M.block_rlagent.data_addons[n].cache.dependencies,function(e,t){M.block_rlagent.data_addons[t].installed||(M.block_rlagent.data_actions.update[t]=t,o={source:n,target:t},i+="<ul>"+M.util.get_string("dependency_will_be_added","block_rlagent",o))})}),e.Object.each(M.block_rlagent.data_actions.remove,function(t,n){e.Object.each(M.block_rlagent.data_addons,function(e,t){typeof e.dependencies!="undefined"&&e.dependencies[n]&&(M.block_rlagent.data_actions.remove[t]=t,o={source:n,target:t},i+="<ul>"+M.util.get_string("dependency_will_be_removed","block_rlagent",o))})}),i.length<=0&&(i="<ul>"+M.util.get_string("no_dependencies","block_rlagent")+"</ul>"),i="<h4>"+M.util.get_string("dependencies","block_rlagent")+"</h4>"+i,e.one("#action-results").insert(i,"before"),M.block_rlagent.action_dropdown_update(),e.one("#modal-content .fa-spinner").hide(),button=e.one("#manage-actions-modal .modal-confirm-button"),button.set("disabled",!1),button.removeClass("yui3-button-disabled"),button=e.one("#manage-actions-modal .modal-cancel-button"),button.set("disabled",!1),button.removeClass("yui3-button-disabled")}function s(t){function n(t,n){var r;t?r="success":r="failure";var s=n.length,o="";if(s>0){for(var u=0;u<s;u+=1)o+="<li>"+n[u]+"</li>\n";o="<ul>"+o+"</ul>\n"}s=i.length;var a="";if(s>0){for(var u=0;u<s;u+=1)a+="<li>"+i[u]+"</li>\n";a="<ul>"+M.util.get_string("plugins_require_configuration","block_rlagent")+"</ul>\n"+"<ul>"+a+"</ul>\n"+"<ul>"+M.util.get_string("plugins_need_help","block_rlagent")+"</ul>\n"}o="<h4>"+M.util.get_string(r,"block_rlagent")+"</h4>\n"+"<ul>"+M.util.get_string("actions_completed_"+r,"block_rlagent")+"</ul>\n"+o+a,e.one("#action-results").insert(o,"before"),e.one("#modal-content .fa-spinner").hide(),$button=e.one("#manage-actions-modal button"),$button.set("disabled",!1),$button.removeClass("yui3-button-disabled")}t.preventDefault();var r="",i=[];e.Object.each(M.block_rlagent.data_actions.add,function(e,t){r.length>0&&(r+="&"),r+="add[]="+t,5===M.block_rlagent.data_addons[t].source&&(i[i.length]=t)}),e.Object.each(M.block_rlagent.data_actions.update,function(e,t){r.length>0&&(r+="&"),r+="update[]="+t}),e.Object.each(M.block_rlagent.data_actions.remove,function(e,t){r.length>0&&(r+="&"),r+="remove[]="+t}),YUI().use("io-base",function(e){var t=M.cfg.wwwroot+"/blocks/rlagent/mass/action.php",i={method:"POST",data:r,on:{success:function(t,r){var i=null;YUI().use("json-parse",function(e){try{i=e.JSON.parse(r.responseText)}catch(t){}});var s=!1;i[0]||(s=!0),Object.keys(M.block_rlagent.data_actions.add).length>0&&e.Object.each(M.block_rlagent.data_actions.add,function(e,t){delete M.block_rlagent.data_actions.add[t]}),Object.keys(M.block_rlagent.data_actions.remove).length>0&&e.Object.each(M.block_rlagent.data_actions.remove,function(e,t){delete M.block_rlagent.data_actions.remove[t]}),Object.keys(M.block_rlagent.data_actions.update).length>0&&e.Object.each(M.block_rlagent.data_actions.update,function(e,t){delete M.block_rlagent.data_actions.update[t]}),M.block_rlagent.action_dropdown_update(),n(s,i)},failure:function(){e.one("#manage-actions-modal button").set("disabled",!1),e.one("#modal-content fa-spinner").hide()}}};$addons=e.io(t,i)})}function o(t){var n=e.one("ul#plugin-actions");!e.one("button.plugin-actions").hasClass("disabled")&&n.getStyle("display")==="none"?n.setStyle("display","block"):n.setStyle("display","none"),n.get("parentNode").toggleClass("open")}var u=e.one(".plugins");u.delegate("click",t,"button.btn-install"),u.delegate("click",n,"button.btn-remove"),u.delegate("click",r,"button.btn-update"),e.one("#go-update-plugins").on("click",i),e.one("button.plugin-actions").on("click",o),e.one("ul#plugin-actions").on("mouseleave",o)},addons_fetch:function(){YUI().use("io-base",function(e){function t(){}function n(e,t){var n=null;YUI().use("json-parse",function(e){try{n=e.JSON.parse(t.responseText)}catch(r){}}),M.block_rlagent.data_addons=n,M.block_rlagent.addons_write(),M.block_rlagent.filter_plugins()}function r(e){}$url=M.cfg.wwwroot+"/blocks/rlagent/mass/addons.php?type=addonlist",e.on("io:complete",t,e,[]),e.on("io:success",n,e,[]),e.on("io:failure",r,e,[M.util.get_string("ajax_request_failed"
,"block_rlagent")]),$addons=e.io($url)})},addons_rate:function(){function t(e){e.preventDefault(),$this=e.target;if(!!M.block_rlagent.plugin_rate_node&&$this===M.block_rlagent.plugin_rate_node)return!1;M.block_rlagent.plugin_rate_node=$this,$starset=M.block_rlagent.plugin_rate_node.get("parentNode").get("children").filter(".fa"),$clickedindex=$starset.indexOf(M.block_rlagent.plugin_rate_node),$fillstars=$starset.slice(0,$clickedindex+1),$emptystars=$starset.slice($clickedindex+1,$starset.size()+1);var t=$clickedindex+1,n=M.block_rlagent.plugin_rate_node.ancestor(".plugin.well").getAttribute("data-key");$starset.each(function(e){e.hasClass("fa-star-o")&&e.removeClass("fa-star-o"),e.hasClass("fa-star")&&e.removeClass("fa-star"),$starset.indexOf(e)===$starset.size()-1&&($emptystars.addClass("fa-star-o"),$fillstars.addClass("fa-star"),M.block_rlagent.addons_rating_send(n,t))})}e.one(".plugins").delegate("click",t,".rate-plugin .fa-star-o, .rate-plugin .fa-star")},addons_rating_send:function(e,t){YUI().use("io-base",function(n){var r=M.cfg.wwwroot+"/blocks/rlagent/mass/rate.php",i={method:"POST",data:"addon="+e+"&rating="+t,on:{success:function(e,t){var n=null;YUI().use("json-parse",function(e){try{n=e.JSON.parse(t.responseText)}catch(r){}})},failure:function(){}}};$addons=n.io(r,i)})},addons_write:function(){e.Object.each(M.block_rlagent.data_addons,function(t,n){$displayname=t.display_name?t.display_name:M.util.get_string("plugin_name_not_available","block_rlagent"),$description=t.description?t.description:M.util.get_string("plugin_description_not_available","block_rlagent"),$myrating=t.myrating?t.myrating:0,$rating=t.rating?t.rating:0,$installed=t.installed?t.installed:!1,$paid=t.paid?t.paid:!1,$updateable=t.upgradeable?t.upgradeable:!1,$cached=t.cached?t.cached:!1,$type=t.type?t.type:"1",$typeclass=" type-"+$type,$nameclass=" name-"+String(t.name).replace(" ","_"),$datakey='data-key="'+String(n).replace(" ","_")+'" ',$datainstalled='data-installed="'+String($installed).replace(" ","_")+'" ',$dataupdateable='data-updateable="'+String($updateable).replace(" ","_")+'" ',$datacached='data-cached="'+String($cached).replace(" ","_")+'" ',$datatype='data-type="'+String($type).replace(" ","_")+'" ',installstring=M.util.get_string("add","block_rlagent"),installclass=" btn-install btn-success",installicon="fa fa-plus",installdataaction=' data-action="add"',blocktype="button",buttonclass="btn btn-block",$installed?(installstring=M.util.get_string("remove","block_rlagent"),installclass=" btn-remove btn-danger",installicon="fa fa-times",installdataaction='data-action="remove"'):$paid&&(installstring=M.util.get_string("for_pricing","block_rlagent"),installclass="",installicon="",installdataaction="",blocktype="div",buttonclass="text-center"),updatedisabled="display:none;",$updateable&&(updatedisabled=""),$buttonmarkup="<"+blocktype+' type="button" class="'+buttonclass+installclass+'"'+installdataaction+">",$buttonmarkup+='<i class="'+installicon+'"></i>',$buttonmarkup+=installstring,$buttonmarkup+="</"+blocktype+">",$upbuttonmarkup='<button type="button" style="'+updatedisabled+'"'+' class="btn btn-block btn-update btn-primary" data-action="update">',$upbuttonmarkup+='<i class="fa fa-level-up"></i>',$upbuttonmarkup+=M.util.get_string("update","block_rlagent"),$upbuttonmarkup+="</button>",$ratingmarkup='<div class="avg-rating"><h5>'+M.util.get_string("average_rating","block_rlagent")+"</h5>";for(i=1;i<6;i++)i<=$rating?$ratingmarkup+='<i class="fa fa-star"></i>':$ratingmarkup+='<i class="fa fa-star-o"></i>';$ratingmarkup+="</div>",$itemmarkup='<ul class="media-list"><li class="media">',$itemmarkup+='<i class="pull-left plugin-type fa '+M.block_rlagent.plugin_types[$type].icon+'"></i>',$itemmarkup+='<div class="media-body">',$itemmarkup+='<h3 class="media-heading">'+$displayname+"</h3>",$itemmarkup+="<p>"+$description+"</p>",$itemmarkup+='<div class="rate-plugin">',$itemmarkup+="<p><strong>"+M.util.get_string("add_or_update_rating_bold","block_rlagent")+"</strong>"+M.util.get_string("add_or_update_rating_normal","block_rlagent")+"</p>";for(i=1;i<6;i++)i<=$myrating?$itemmarkup+='<i class="fa fa-star" title="'+i+' stars"></i>':$itemmarkup+='<i class="fa fa-star-o" title="'+i+' stars"></i>';$itemmarkup+="</div>",$itemmarkup+="</div>",$itemmarkup+="</li></ul>",$html='<div class="plugin well'+$typeclass+$nameclass+'" '+$datakey+$datainstalled+$dataupdateable+$datacached+$datatype+' style="display: none;" hidden="hidden">',$html+='<div class="choose">',$html+=$buttonmarkup,$html+=$upbuttonmarkup,$html+=$ratingmarkup,$html+="</div>",$html+=$itemmarkup,$html+="</div>",e.one(".plugin-select .plugins").insert($html)}),M.block_rlagent.addons_rate(),M.block_rlagent.addons_button_init()},capitalise_firstletter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},filter_init:function(){M.block_rlagent.filter_select(),M.block_rlagent.filter_clear(),M.block_rlagent.filter_text(),M.block_rlagent.filter_checkbox(),M.block_rlagent.filter_dropdown_visibility(),M.block_rlagent.addons_fetch()},filter_add:function(t,n,r){$labelsbox=e.one("#labels-box"),$labelsbox.getStyle("display")==="none"&&$labelsbox.setStyle("display","block"),$filters=e.all("#filter-labels span.badge"),$filterlist=$filters.get("text");var i=[];return e.Array.each($filterlist,function(e){i.push(e.trim())}),$prefix=M.block_rlagent.capitalise_firstletter(n)+" | ",i.indexOf($prefix+t)<=-1?($labelmarkup='<span class="badge" data-filter-mode="'+n+'" data-filter-refine="'+r+'">'+$prefix+t+'<i class="fa fa-times" alt="'+M.util.get_string("remove_filter","block_rlagent")+'"></i></span>',$filters.length>=1?$item=$filters.item($filterlist.length-1).insert($labelmarkup,"after"):$item=e.one("#filter-labels").insert($labelmarkup),M.block_rlagent.filter_plugins(),M.block_rlagent.filter_remove(),M.block_rlagent.filter_block_show(),$item):!1},filter_checkbox:function(){$input=e.one("input#trust-filter"),$input.on("change",M.block_rlagent.filter_plugins)},filter_select:function(
){e.all("ul#select-filters li").on("click",function(t){$target=e.one(t.currentTarget),$label=$target.one("a").get("text"),$mode=$target.getAttribute("data-filter-mode"),$refine=$target.getAttribute("data-filter-refine"),M.block_rlagent.filter_add($label,$mode,$refine)})},filter_dropdown_visibility:function(){var t={btn:e.one("#btn-select-filter"),li:e.all("ul#select-filters li"),ul:e.one("ul#select-filters")};t.btn.on("click",function(){t.ul.getStyle("display")==="block"?(t.ul.setStyle("display","none"),t.ul.get("parentNode").toggleClass("open")):(t.ul.setStyle("display","block"),t.ul.get("parentNode").toggleClass("open"))}),t.li.on("click",function(){t.ul.getStyle("display")==="block"?(t.ul.setStyle("display","none"),t.ul.get("parentNode").toggleClass("open")):(t.ul.setStyle("display","block"),t.ul.get("parentNode").toggleClass("open"))}),t.ul.on("mouseleave",function(){t.ul.setStyle("display","none"),t.ul.get("parentNode").toggleClass("open")})},filter_text:function(){function t(){$value=e.one("input#plugin-filter").get("value"),$value.length>=1&&(M.block_rlagent.filter_add($value,"string",$value),$input.set("value","")),M.block_rlagent.filter_block_show()}$input=e.one("input#plugin-filter"),$inputengaged=!1,$input.on("click",function(e){$input=e.target,$input.set("value",""),$inputengaged=!0,$input.on("blur",function(){$inputengaged=!1}),$input.on("key",t,"enter")})},filter_clear:function(){$clearbutton=e.one("button#clear-filters"),$clearbutton.on("click",function(){e.all("#filter-labels span.badge").remove(!0),M.block_rlagent.filter_plugins(),M.block_rlagent.filter_block_hide()})},filter_block_show:function(){e.all("#filter-labels span.badge").size()>=1&&e.one("#labels-box").show(!0)},filter_block_hide:function(){e.all("#filter-labels span.badge").size()<=0&&(e.one("#labels-box").hide(!0),M.block_rlagent.filter_plugins())},filter_remove:function(){$removebutton=e.all("#filter-labels i.fa-times"),$removebutton.on("click",function(e){$target=e.target.get("parentNode").remove(!0),M.block_rlagent.filter_plugins(),M.block_rlagent.filter_block_hide()})},filter_plugins:function(){function s(){var t=e.one("#trust-filter").get("checked");if(!t)return o(),!1;var n;e.Object.each($addons,function(e,t){n=!0;if(e.source===4||e.source===5)n=!1;n&&(e.filtered=!0)}),o()}function o(){if(M.block_rlagent.data_filters.type.length<=0)return u(),!1;var t;e.Object.each($addons,function(n,r){t=!0,e.Array.each(M.block_rlagent.data_filters.type,function(e,r){n.type===e&&(t=!1)}),t&&(n.filtered=!0)}),u()}function u(){if(M.block_rlagent.data_filters.status.length<=0)return a(),!1;var t;e.Object.each($addons,function(n,r){t=!0,e.Array.each(M.block_rlagent.data_filters.status,function(e,r){e==="installed"&&n.installed?t=!1:e==="notinstalled"&&!n.installed?t=!1:e==="updateable"&&n.installed&&n.upgradeable&&(t=!1)}),t&&(n.filtered=!0)}),a()}function a(){if(M.block_rlagent.data_filters.string.length<=0)return!1;var t;e.Object.each($addons,function(n,r){$heading=String(n.display_name).toLowerCase(),$description=String(n.description).toLowerCase(),$name=String(r).toLowerCase(),t=!1,e.Array.each(M.block_rlagent.data_filters.string,function(e,n){$stringlowcaps=e.toLowerCase(),$isinheading=$heading.indexOf($stringlowcaps),$isindesc=$description.indexOf($stringlowcaps),$isinname=$name.indexOf($stringlowcaps),$isinheading<0&&$isindesc<0&&$isinname<0&&(t=!0)}),t&&(n.filtered=!0)})}e.all(".plugins .plugin.well").hide(!0),$filters=e.all("#filter-labels span.badge");var t,n,r=M.block_rlagent.filter_types.length;for(var i=0;i<r;i+=1)n=M.block_rlagent.filter_types[i],M.block_rlagent.data_filters[n]=[],$filters.filter('[data-filter-mode="'+n+'"]').each(function(r){t=e.one(r).getAttribute("data-filter-refine"),M.block_rlagent.data_filters[n].push(t)});$addons=JSON.parse(JSON.stringify(M.block_rlagent.data_addons)),e.Object.each($addons,function(e,t){e.filtered=!1}),s(),e.Object.each($addons,function(t,n){$key=String(n).replace(" ","_"),$selector='.plugin[data-key="'+$key+'"]';var r=e.one($selector);r&&(t.filtered||r.show(!0))})},update_continue_init:function(){e.one("#afterupdate").on("click",function(){e.one(".site-update").hide(!0,function(){e.one(".plugin-select").setStyle("display","block").hide().show(!0)}),M.block_rlagent.filter_init()})},update_site_init:function(){e.one("#doupdate").on("click",function(t){t.target.setAttribute("disabled"),e.one("#skipupdate").setAttribute("disabled"),e.one(".site-update-spinner").show(!0);var n=e.one(".site-update-spinner .fa-spinner"),r=e.one("div.instr-continue"),i=e.one("#afterupdate");YUI().use("io-base",function(e){var t=M.cfg.wwwroot+"/blocks/rlagent/mass/refresh.php",s={method:"POST",data:"",on:{success:function(e,t){var s=null;YUI().use("json-parse",function(e){try{s=e.JSON.parse(t.responseText)}catch(n){}}),n.hide(!0),r.show(!0),i.show(!0)},failure:function(){n.hide(!0)}}},o=e.io(t,s)})})},update_skip_init:function(){e.one("#skipupdate").on("click",function(){e.one(".site-update").hide(!0,function(){e.one(".plugin-select").setStyle("display","block").hide().show(!0)}),M.block_rlagent.filter_init()})},init:function(){$update=e.one(".site-update"),$update?(M.block_rlagent.update_continue_init(),M.block_rlagent.update_skip_init(),M.block_rlagent.update_site_init()):M.block_rlagent.filter_init()}}},"@VERSION@",{requires:["base","node","panel","plugin","transition","event","event-delegate"]});
