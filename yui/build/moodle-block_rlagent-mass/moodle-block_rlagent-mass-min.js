YUI.add("moodle-block_rlagent-mass",function(e,t){M.block_rlagent=M.block_rlagent||{},M.block_rlagent={data_actions:{add:{},remove:{},update:{}},data_addons:{},plugin_modal:null,plugin_rate_node:null,plugin_types:{block:{type:"block",title:M.util.get_string("title_block","block_rlagent"),icon:"fa-square-o"},mod:{type:"mod",title:M.util.get_string("title_module","block_rlagent"),icon:"fa-rocket"},auth:{type:"auth",title:M.util.get_string("title_auth","block_rlagent"),icon:"fa-key"},enrol:{type:"enrol",title:M.util.get_string("title_enrol","block_rlagent"),icon:"fa-group"},filter:{type:"filter",title:M.util.get_string("title_filter","block_rlagent"),icon:"fa-filter"},format:{type:"format",title:M.util.get_string("title_format","block_rlagent"),icon:"fa-columns"},gradeexport:{type:"gradeexport",title:M.util.get_string("title_gradeexport","block_rlagent"),icon:"fa-download"},local:{type:"local",title:M.util.get_string("title_local","block_rlagent"),icon:"fa-home"},qtype:{type:"qtype",title:M.util.get_string("title_qtype","block_rlagent"),icon:"fa-check-square-o"},repository:{type:"repository",title:M.util.get_string("title_repository","block_rlagent"),icon:"fa-folder-open"},theme:{type:"theme",title:M.util.get_string("title_theme","block_rlagent"),icon:"fa-picture-o"},tinymce:{type:"tinymce",title:M.util.get_string("title_tinymce","block_rlagent"),icon:"fa-text-height"},plagiarism:{type:"plagiarism",title:M.util.get_string("title_plagiarism","block_rlagent"),icon:"fa-eye"}},plugin_fetch_addons:function(){YUI().use("io-base",function(e){function t(){}function n(e,t){var n=null;YUI().use("json-parse",function(e){try{n=e.JSON.parse(t.responseText)}catch(r){}}),M.block_rlagent.data_addons=n,M.block_rlagent.plugin_write_addons()}function r(e){}$url=M.cfg.wwwroot+"/blocks/rlagent/mass/addons.php?type=addonlist",e.on("io:complete",t,e,[]),e.on("io:success",n,e,[]),e.on("io:failure",r,e,[M.util.get_string("ajax_request_failed","block_rlagent")]),$addons=e.io($url)})},plugin_write_addons:function(){e.Object.each(M.block_rlagent.data_addons,function(t,n){$displayname=t.display_name?t.display_name:M.util.get_string("plugin_name_not_available","block_rlagent"),$description=t.description?t.description:M.util.get_string("plugin_description_not_available","block_rlagent"),$myrating=t.myrating?t.myrating:0,$rating=t.rating?t.rating:0,$installed=t.installed?t.installed:!1,$updateable=t.upgradeable?t.upgradeable:!1,$cached=t.cached?t.cached:!1,$type=t.type?t.type:"1",$typeclass=" type-"+$type,$nameclass=" name-"+String(t.name).replace(" ","_"),$datakey='data-key="'+String(n).replace(" ","_")+'" ',$datainstalled='data-installed="'+String($installed).replace(" ","_")+'" ',$dataupdateable='data-updateable="'+String($updateable).replace(" ","_")+'" ',$datacached='data-cached="'+String($cached).replace(" ","_")+'" ',$datatype='data-type="'+String($type).replace(" ","_")+'" ',$installstring=M.util.get_string("add","block_rlagent"),$installclass="btn-install btn-success",$installicon="fa fa-plus",$installdataaction='data-action="add"',$installed&&($installstring=M.util.get_string("remove","block_rlagent"),$installclass="btn-remove btn-danger",$installicon="fa fa-times",$installdataaction='data-action="remove"'),$updatedisabled="display:none;",$updateable&&($updatedisabled=""),$buttonmarkup='<button type="button" class="btn '+$installclass+'"'+$installdataaction+">",$buttonmarkup+='<i class="'+$installicon+'"></i>',$buttonmarkup+=$installstring,$buttonmarkup+="</button>",$upbuttonmarkup='<button type="button" style="'+$updatedisabled+'" class="btn btn-update btn-primary"'+' data-action="update">',$upbuttonmarkup+='<i class="fa fa-level-up"></i>',$upbuttonmarkup+=M.util.get_string("update","block_rlagent"),$upbuttonmarkup+="</button>",$ratingmarkup='<div class="avg-rating"><h5>'+M.util.get_string("average_rating","block_rlagent")+"</h5>";for(i=1;i<6;i++)i<=$rating?$ratingmarkup+='<i class="fa fa-star"></i>':$ratingmarkup+='<i class="fa fa-star-o"></i>';$ratingmarkup+="</div>",$itemmarkup='<ul class="media-list"><li class="media">',$itemmarkup+='<i class="pull-left plugin-type fa '+M.block_rlagent.plugin_types[$type].icon+'"></i>',$itemmarkup+='<div class="media-body">',$itemmarkup+='<h3 class="media-heading">'+$displayname+"</h3>",$itemmarkup+="<p>"+$description+"</p>",$itemmarkup+='<div class="rate-plugin">',$itemmarkup+="<p><strong>"+M.util.get_string("add_or_update_rating_bold","block_rlagent")+"</strong>"+M.util.get_string("add_or_update_rating_normal","block_rlagent")+"</p>";for(i=1;i<6;i++)i<=$myrating?$itemmarkup+='<i class="fa fa-star" title="'+i+' stars"></i>':$itemmarkup+='<i class="fa fa-star-o" title="'+i+' stars"></i>';$itemmarkup+="</div>",$itemmarkup+="</div>",$itemmarkup+="</li></ul>",$html='<div class="plugin well'+$typeclass+$nameclass+'" '+$datakey+$datainstalled+$dataupdateable+$datacached+$datatype+">",$html+='<div class="choose">',$html+=$buttonmarkup,$html+=$upbuttonmarkup,$html+=$ratingmarkup,$html+="</div>",$html+=$itemmarkup,$html+="</div>",e.one(".plugin-select .plugins").insert($html)}),M.block_rlagent.plugin_rate_plugins(),M.block_rlagent.plugin_buttons()},skip_update_init:function(){$button=e.one("#skipupdate"),e.one("#skipupdate").on("click",function(){e.one(".site-update").hide(!0,function(){e.one(".plugin-select").setStyle("display","block").hide().show(!0)}),M.block_rlagent.plugin_select_init()})},update_site_init:function(){e.one("#doupdate").on("click",function(t){t.target.setAttribute("disabled"),e.one(".site-update-spinner").show(!0),$useremail=e.one(".useremail").get("text")})},plugin_select_init:function(){M.block_rlagent.plugin_select_filter(),M.block_rlagent.plugin_clear_filters(),M.block_rlagent.plugin_input_filter(),M.block_rlagent.plugin_dropdown_visibility(),M.block_rlagent.plugin_fetch_addons(),M.block_rlagent.plugin_filter_scroll()},plugin_capitalise_firstletter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},plugin_add_filter:function(t,n,r){$labelsbox=e.one("#labels-box"
),$labelsbox.getStyle("display")==="none"&&$labelsbox.setStyle("display","block"),$filters=e.all("#filter-labels span.badge"),$filterlist=$filters.get("text");var i=[];return e.Array.each($filterlist,function(e){i.push(e.trim())}),$prefix=M.block_rlagent.plugin_capitalise_firstletter(n)+" | ",i.indexOf($prefix+t)<=-1?($labelmarkup='<span class="badge" data-filter-mode="'+n+'" data-filter-refine="'+r+'">'+$prefix+t+'<i class="fa fa-times" alt="'+M.util.get_string("remove_filter","block_rlagent")+'"></i></span>',$filters.length>=1?$item=$filters.item($filterlist.length-1).insert($labelmarkup,"after"):$item=e.one("#filter-labels").insert($labelmarkup),M.block_rlagent.plugin_filter_plugins(),M.block_rlagent.plugin_remove_filter(),M.block_rlagent.plugin_show_filterblock(),$item):!1},plugin_select_filter:function(){e.all("ul#select-filters li").on("click",function(t){$target=e.one(t.currentTarget),$label=$target.one("a").get("text"),$mode=$target.getAttribute("data-filter-mode"),$refine=$target.getAttribute("data-filter-refine"),M.block_rlagent.plugin_add_filter($label,$mode,$refine)})},plugin_dropdown_visibility:function(){$filter_ul=e.one("ul#select-filters"),$filter_li=e.all("ul#select-filters li"),$filter_btn=e.one("#btn-select-filter"),$filter_btn.on("click",function(){$filter_ul.getStyle("display")==="block"?($filter_ul.setStyle("display","none"),$filter_ul.get("parentNode").toggleClass("open")):($filter_ul.setStyle("display","block"),$filter_ul.get("parentNode").toggleClass("open"))}),$filter_li.on("click",function(){$filter_ul.getStyle("display")==="block"?($filter_ul.setStyle("display","none"),$filter_ul.get("parentNode").toggleClass("open")):($filter_ul.setStyle("display","block"),$filter_ul.get("parentNode").toggleClass("open"))}),$filter_ul.on("mouseleave",function(){$filter_ul.setStyle("display","none"),$filter_ul.get("parentNode").toggleClass("open")})},plugin_input_filter:function(){function t(){$filter=e.one("input#plugin-filter").get("value"),$filter.length>=1&&(M.block_rlagent.plugin_add_filter($filter,"string",$filter),$input.set("value","")),M.block_rlagent.plugin_show_filterblock()}$input=e.one("input#plugin-filter"),$inputengaged=!1,$input.on("click",function(){$input.set("value",""),$inputengaged=!0,$input.on("blur",function(){$inputengaged=!1}),$input.on("key",t,"enter")})},plugin_clear_filters:function(){$clearbutton=e.one("button#clear-filters"),$clearbutton.on("click",function(){e.all("#filter-labels span.badge").remove(!0),M.block_rlagent.plugin_filter_plugins(),M.block_rlagent.plugin_hide_filterblock()})},plugin_show_filterblock:function(){e.all("#filter-labels span.badge").size()>=1&&e.one("#labels-box").show(!0)},plugin_hide_filterblock:function(){e.all("#filter-labels span.badge").size()<=0&&(e.one("#labels-box").hide(!0),e.all(".plugins .plugin.well").show(!0))},plugin_remove_filter:function(){$removebutton=e.all("#filter-labels i.fa-times"),$removebutton.on("click",function(e){$target=e.target.get("parentNode").remove(!0),M.block_rlagent.plugin_filter_plugins(),M.block_rlagent.plugin_hide_filterblock()})},plugin_rate_plugins:function(){function t(e){e.preventDefault(),$this=e.target;if(!!M.block_rlagent.plugin_rate_node&&$this===M.block_rlagent.plugin_rate_node)return!1;M.block_rlagent.plugin_rate_node=$this,$starset=M.block_rlagent.plugin_rate_node.get("parentNode").get("children").filter(".fa"),$clickedindex=$starset.indexOf(M.block_rlagent.plugin_rate_node),$fillstars=$starset.slice(0,$clickedindex+1),$emptystars=$starset.slice($clickedindex+1,$starset.size()+1);var t=$clickedindex+1,n=M.block_rlagent.plugin_rate_node.ancestor(".plugin.well").getAttribute("data-key");$starset.each(function(e){e.hasClass("fa-star-o")&&e.removeClass("fa-star-o"),e.hasClass("fa-star")&&e.removeClass("fa-star"),$starset.indexOf(e)===$starset.size()-1&&($emptystars.addClass("fa-star-o"),$fillstars.addClass("fa-star"),M.block_rlagent.plugin_send_rating(n,t))})}e.one(".plugins").delegate("click",t,".rate-plugin .fa-star-o, .rate-plugin .fa-star")},plugin_update_action_dropdown:function(){function t(t){t.preventDefault,$this=t.target,$key=$this.ancestor("li").getAttribute("data-key"),$action=$this.ancestor("li").getAttribute("data-action"),$this.ancestor("li").remove(!0),delete M.block_rlagent.data_actions[$action][$key],$btn=e.one('.plugin.well[data-key="'+$key+'"] button[data-action="'+$action+'"]'),$btn.hasClass("disabled")&&$btn.removeClass("disabled"),Object.keys(M.block_rlagent.data_actions.add).length===0&&Object.keys(M.block_rlagent.data_actions.remove).length===0&&Object.keys(M.block_rlagent.data_actions.update).length===0&&($dropbtn.hasClass("disabled")||$dropbtn.addClass("disabled"),$updatebtn.hasClass("disabled")||$updatebtn.addClass("disabled"))}$ul=e.one("ul#plugin-actions"),$dropbtn=e.one("button.plugin-actions"),$updatebtn=e.one("#go-update-plugins"),$ul.detach("click");if(Object.keys(M.block_rlagent.data_actions.add).length===0&&Object.keys(M.block_rlagent.data_actions.remove).length===0&&Object.keys(M.block_rlagent.data_actions.update).length===0)return $items=$ul.children(li),$items.size()&&$ul.empty(),$dropbtn.hasClass("disabled")||$dropbtn.addClass("disabled"),$updatebtn.hasClass("disabled")||$updatebtn.addClass("disabled"),!1;Object.keys(M.block_rlagent.data_actions.add).length>0&&($ul.all('[data-action="add"]').remove(!0),e.Object.each(M.block_rlagent.data_actions.add,function(e,t){var n;n='<li data-action="add" ',n+='data-key="'+t+'">',n+='<i class="fa fa-plus" alt="'+M.util.get_string("to_be_added","block_rlagent")+'"></i>',n+=M.block_rlagent.data_addons[t].display_name,n+='<i class="fa fa-times-circle rm-action" alt="'+M.util.get_string("remove_action","block_rlagent")+'"></i>',n+="</li>",$ul.append(n)}),$dropbtn.hasClass("disabled")&&$dropbtn.removeClass("disabled"),$updatebtn.hasClass("disabled")&&$updatebtn.removeClass("disabled")),Object.keys(M.block_rlagent.data_actions.remove).length>0&&($ul.all('[data-action="remove"]').remove(!0),e.Object.each(M.block_rlagent
.data_actions.remove,function(e,t){var n;n='<li data-action="remove" ',n+='data-key="'+t+'">',n+='<i class="fa fa-times" alt="'+M.util.get_string("to_be_added","block_rlagent")+'"></i>',n+=M.block_rlagent.data_addons[t].display_name,n+='<i class="fa fa-times-circle rm-action" alt="'+M.util.get_string("remove_action","block_rlagent")+'"></i>',n+="</li>",$ul.append(n)}),$dropbtn.hasClass("disabled")&&$dropbtn.removeClass("disabled"),$updatebtn.hasClass("disabled")&&$updatebtn.removeClass("disabled")),Object.keys(M.block_rlagent.data_actions.update).length>0&&($ul.all('[data-action="update"]').remove(!0),e.Object.each(M.block_rlagent.data_actions.update,function(e,t){var n;n='<li data-action="update" ',n+='data-key="'+t+'">',n+='<i class="fa fa-level-up" alt="'+M.util.get_string("to_be_updated","block_rlagent")+'"></i>',n+=M.block_rlagent.data_addons[t].display_name,n+='<i class="fa fa-times-circle rm-action" alt="'+M.util.get_string("remove_action","block_rlagent")+'"></i>',n+="</li>",$ul.append(n)}),$dropbtn.hasClass("disabled")&&$dropbtn.removeClass("disabled"),$updatebtn.hasClass("disabled")&&$updatebtn.removeClass("disabled")),$ul.delegate("click",t,".rm-action")},plugin_buttons:function(){function t(e){e.preventDefault(),$this=e.target;var t=$this.ancestor(".plugin.well").getAttribute("data-key");M.block_rlagent.data_actions.add[t]=t,$this.addClass("disabled"),M.block_rlagent.plugin_update_action_dropdown()}function n(e){e.preventDefault(),$this=e.target;var t=$this.ancestor(".plugin.well").getAttribute("data-key");M.block_rlagent.data_actions.remove[t]=t,$this.addClass("disabled"),M.block_rlagent.plugin_update_action_dropdown()}function r(e){e.preventDefault(),$this=e.target;var t=$this.ancestor(".plugin.well").getAttribute("data-key");M.block_rlagent.data_actions.update[t]=t,$this.addClass("disabled"),M.block_rlagent.plugin_update_action_dropdown()}function i(t){function o(t){if(t){var n="<h4>"+M.util.get_string("success","block_rlagent")+"</h4>";n+=M.util.get_string("actions_completed_success","block_rlagent")}else{var n="<h4>"+M.util.get_string("failure","block_rlagent")+"</h4>";n+=M.util.get_string("actions_completed_failure","block_rlagent")}e.one("#action-results").insert(n,"before"),e.one("#modal-content .fa-spinner").hide(),button=e.one("#manage-actions-modal button"),button.set("disabled",!1),button.removeClass("yui3-button-disabled")}t.preventDefault();var n="<ul>"+M.util.get_string("plugins_will_be_added","block_rlagent"),r;for(r in M.block_rlagent.data_actions.add)n+="<li>"+r+"</li>";n+="</ul>",n+="<ul>"+M.util.get_string("plugins_will_be_updated","block_rlagent");for(r in M.block_rlagent.data_actions.update)n+="<li>"+r+"</li>";n+="</ul>",n+="<ul>"+M.util.get_string("plugins_will_be_removed","block_rlagent");for(r in M.block_rlagent.data_actions.remove)n+="<li>"+r+"</li>";n+="</ul>",$bodycontent='<div id="modal-content">',$bodycontent+="<h4>"+M.util.get_string("preparing_actions","block_rlagent")+"</h4>",$bodycontent+="<p>"+n+"</p>",$bodycontent+='<div id="action-results"><i class="fa fa-spinner fa-spin fa-4"></i></div>',$bodycontent+="</div>",YUI().use("panel",function(e){M.block_rlagent.plugin_modal=new e.Panel({srcNode:"<div></div>",id:"manage-actions-modal",headerContent:M.util.get_string("actions_in_progress","block_rlagent"),bodyContent:$bodycontent,buttons:[{id:"modal-close-button",label:"Close",section:"footer",visible:!1,action:function(e){e.preventDefault(),M.block_rlagent.plugin_modal.hide(),M.block_rlagent.plugin_modal.destroy()},classNames:"modal-close-button",disabled:!0}],classNames:"manage-actions-modal",width:"60%",height:500,zIndex:1e4,centered:!0,modal:!0,visible:!0,render:!0})});var i="",s="<h4>"+M.util.get_string("dependencies","block_rlagent")+"</h4>";e.Object.each(M.block_rlagent.data_actions.add,function(t,n){i.length>0&&(i+="&"),i+="add[]="+n,e.Object.each(M.block_rlagent.data_addons[n].dependencies,function(e,t){if(!M.block_rlagent.data_addons[t].installed){i+="add[]="+t;var r={source:n,target:t};s+="<ul>"+M.util.get_string("dependency_will_be_added","block_rlagent",r)}})}),e.Object.each(M.block_rlagent.data_actions.update,function(t,n){i.length>0&&(i+="&"),i+="update[]="+n,e.Object.each(M.block_rlagent.data_addons[n].dependencies,function(e,t){if(!M.block_rlagent.data_addons[t].installed){i+="update[]="+t;var r={source:n,target:t};s+="<ul>"+M.util.get_string("dependency_will_be_added","block_rlagent",r)}})}),e.Object.each(M.block_rlagent.data_actions.remove,function(t,n){i.length>0&&(i+="&"),i+="remove[]="+n,e.Object.each(M.block_rlagent.data_addons[n].dependencies,function(t,n){$neededby=[],e.Object.each(M.block_rlagent.data_addons,function(e,n){e.dependencies[t]&&$neededby.push(n)}),$neededby.length<=0&&(data+="&remove[]="+n)})}),s.length<=0&&(s=M.util.get_string("no_dependencies","block_rlagent")),e.one("#action-results").insert(s,"before"),YUI().use("io-base",function(e){var t=M.cfg.wwwroot+"/blocks/rlagent/mass/action.php",n={method:"POST",data:i,on:{success:function(e,t){var n=null;YUI().use("json-parse",function(e){try{n=e.JSON.parse(t.responseText)}catch(r){}});var r=!1;n[0]||(r=!0),o(r)},failure:function(){e.one("#manage-actions-modal button").set("disabled",!1),e.one("#modal-content fa-spinner").hide()}}};$addons=e.io(t,n)})}function s(t){var n=e.one("ul#plugin-actions");n.getStyle("display")==="none"?n.setStyle("display","block"):n.setStyle("display","none"),n.get("parentNode").toggleClass("open")}var o=e.one(".plugins");o.delegate("click",t,"button.btn-install"),o.delegate("click",n,".btn-remove"),o.delegate("click",r,".btn-update"),e.one("#go-update-plugins").on("click",i),e.one("button.plugin-actions").on("click",s),e.one("ul#plugin-actions").on("mouseleave",s)},plugin_send_rating:function(e,t){YUI().use("io-base",function(n){var r=M.cfg.wwwroot+"/blocks/rlagent/mass/rate.php",i={method:"POST",data:"addon="+e+"&rating="+t,on:{success:function(e,t){var n=null;YUI().use("json-parse",function(e){try{n=e.JSON.parse(t.responseText)}catch(
r){}})},failure:function(){}}};$addons=n.io(r,i)})},plugin_filter_plugins:function(){function t(){if($typefilters.length<=0)return n(),!1;var t;e.Object.each($addons,function(n,r){t=!0,e.Array.each($typefilters,function(e,r){n.type===e&&(t=!1)}),t&&(n.filtered=!0)}),n()}function n(){if($statusfilters.length<=0)return r(),!1;var t;e.Object.each($addons,function(n,r){t=!0,e.Array.each($statusfilters,function(e,r){e==="installed"&&n.installed?t=!1:e==="notinstalled"&&!n.installed?t=!1:e==="updateable"&&n.installed&&n.upgradeable&&(t=!1)}),t&&(n.filtered=!0)}),r()}function r(){var t;e.Object.each($addons,function(n,r){$heading=String(n.display_name).toLowerCase(),$description=String(n.description).toLowerCase(),$name=String(r).toLowerCase(),t=!1,e.Array.each($stringfilters,function(e,n){$stringlowcaps=e.toLowerCase(),$isinheading=$heading.indexOf($stringlowcaps),$isindesc=$description.indexOf($stringlowcaps),$isinname=$name.indexOf($stringlowcaps),$isinheading<0&&$isindesc<0&&$isinname<0&&(t=!0)}),t&&(n.filtered=!0)})}e.all(".plugins .plugin.well").hide(!0),$filters=e.all("#filter-labels span.badge"),$typefilters=[],$filters.filter('[data-filter-mode="type"]').each(function(t){var n=e.one(t).getAttribute("data-filter-refine"),r;e.Object.each(M.block_rlagent.plugin_types,function(e,t){e.type===n&&(r=t)}),$typefilters.push(n),$typefilters.push(r)}),$statusfilters=[],$filters.filter('[data-filter-mode="status"]').each(function(t){$refine=e.one(t).getAttribute("data-filter-refine"),$statusfilters.push($refine)}),$stringfilters=[],$filters.filter('[data-filter-mode="string"]').each(function(t){$refine=e.one(t).getAttribute("data-filter-refine"),$stringfilters.push($refine)}),$addons=JSON.parse(JSON.stringify(M.block_rlagent.data_addons)),e.Object.each($addons,function(e,t){e.filtered=!1}),t(),e.Object.each($addons,function(t,n){$key=String(n).replace(" ","_"),$selector='.plugin[data-key="'+$key+'"]';var r=e.one($selector);r&&!t.filtered&&r.show(!0)})},plugin_filter_scroll:function(){},init:function(){$update=e.one(".site-update"),$update&&($shown=$update.getStyle("display")),$shown=="block"?(M.block_rlagent.skip_update_init(),M.block_rlagent.update_site_init()):M.block_rlagent.plugin_select_init()}}},"@VERSION@",{requires:["base","node","panel","plugin","transition","event","event-delegate"]});
